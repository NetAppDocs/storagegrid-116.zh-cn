---
permalink: ilm/example-6-changing-ilm-policy.html 
sidebar: sidebar 
keywords: change ILM policy, example ILM policy, information lifecycle policy example 
summary: 如果需要更改数据保护或添加新站点，您可能需要创建并激活新的 ILM 策略。 
---
= 示例 6 ：更改 ILM 策略
:icons: font
:imagesdir: ../media/


[role="lead"]
如果需要更改数据保护或添加新站点，您可能需要创建并激活新的 ILM 策略。

在更改策略之前，您必须了解 ILM 放置的更改如何临时影响 StorageGRID 系统的整体性能。

在此示例中，扩展中添加了一个新的 StorageGRID 站点，需要修改活动的 ILM 策略，以便将数据存储在新站点上。


CAUTION: 以下 ILM 规则和策略仅为示例。配置 ILM 规则的方法有多种。在激活新策略之前，请模拟建议的策略，以确认它将按预期工作，以防止内容丢失。



== 更改 ILM 策略如何影响性能

激活新的 ILM 策略时， StorageGRID 系统的性能可能会暂时受到影响，尤其是在新策略中的放置说明要求将许多现有对象移动到新位置时。


CAUTION: 激活新的 ILM 策略时， StorageGRID 会使用它来管理所有对象，包括现有对象和新载入的对象。在激活新的 ILM 策略之前，请查看对现有复制对象和纠删编码对象的放置方式所做的任何更改。在评估和实施新放置时，更改现有对象的位置可能会导致临时资源问题。

可能会暂时影响 StorageGRID 性能的 ILM 策略更改类型包括：

* 将不同的擦除编码配置文件应用于现有擦除编码对象。
+

NOTE: StorageGRID 认为每个擦除编码配置文件都是唯一的，使用新配置文件时不会重复使用擦除编码片段。

* 更改现有对象所需的副本类型；例如，将大量复制对象转换为经过纠删编码的对象。
* 将现有对象的副本移动到完全不同的位置；例如，将大量对象移入或移出云存储池，或者移动到远程站点或从远程站点移动。


xref:creating-ilm-policy.adoc[创建 ILM 策略]



== 示例 6 中的活动 ILM 策略：两个站点的数据保护

在此示例中，活动 ILM 策略最初是为双站点 StorageGRID 系统设计的，并使用两个 ILM 规则。

image::../media/policy_6_active_policy.png[ILM 策略 6 活动策略示例]

在此 ILM 策略中，属于租户 A 的对象在一个站点上通过 2+1 纠删编码进行保护，而属于所有其他租户的对象则通过双副本复制在两个站点之间进行保护。


NOTE: 本示例中的第一个规则使用高级筛选器来确保纠删编码不会用于小型对象。如果租户 A 的任何对象小于 1 MB ，则会受第二个规则的保护，该规则使用复制。



=== 规则 1 ：租户 A 的单站点纠删编码

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
规则名称
 a| 
租户 A 的单站点擦除编码



 a| 
租户帐户
 a| 
租户 A



 a| 
存储池
 a| 
数据中心 1.



 a| 
内容放置
 a| 
从第 0 天到永久，在 Data Center 1 中执行 2+1 纠删编码

|===


=== 规则 2 ：为其他租户进行双站点复制

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
规则名称
 a| 
适用于其他租户的双站点复制



 a| 
租户帐户
 a| 
忽略



 a| 
存储池
 a| 
数据中心 1 和数据中心 2



 a| 
内容放置
 a| 
从第 0 天复制到永久的两个副本：一个副本位于数据中心 1 ，一个副本位于数据中心 2 。

|===


== 示例 6 的建议 ILM 策略：三个站点的数据保护

在此示例中，正在为三站点 StorageGRID 系统更新 ILM 策略。

执行扩展以添加新站点后，网格管理员创建了两个新存储池：一个用于 Data Center 3 的存储池和一个包含所有三个站点的存储池（与所有存储节点默认存储池不同）。然后，管理员创建了两个新的 ILM 规则和一个新的建议 ILM 策略，该策略旨在保护所有三个站点的数据。

image::../media/policy_6_proposed_policy.png[ILM 策略 6 建议策略示例]

激活此新 ILM 策略后，属于租户 A 的对象将在三个站点上通过 2+1 纠删编码得到保护，而属于其他租户（以及属于租户 A 的较小对象）的对象将通过三个副本复制在三个站点上得到保护。



=== 规则 1 ：租户 A 的三站点纠删编码

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
规则名称
 a| 
租户 A 的三站点擦除编码



 a| 
租户帐户
 a| 
租户 A



 a| 
存储池
 a| 
全部 3 个数据中心（包括数据中心 1 ，数据中心 2 和数据中心 3 ）



 a| 
内容放置
 a| 
从第 0 天到永久，在所有 3 个数据中心进行 2+1 纠删编码

|===


=== 规则 2 ：对其他租户进行三站点复制

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
规则名称
 a| 
适用于其他租户的三站点复制



 a| 
租户帐户
 a| 
忽略



 a| 
存储池
 a| 
数据中心 1 ，数据中心 2 和数据中心 3



 a| 
内容放置
 a| 
从第 0 天复制到永久的三个副本：在数据中心 1 复制一个副本，在数据中心 2 复制一个副本，在数据中心 3 复制一个副本。

|===


== 激活示例 6 的建议 ILM 策略

激活新建议的 ILM 策略时，可能会根据任何新规则或更新的规则中的放置说明将现有对象移动到新位置，或者为现有对象创建新的对象副本。


CAUTION: ILM 策略中的错误可能会导致发生原因 丢失不可恢复的数据。在激活策略之前，请仔细查看并模拟策略，以确认策略将按预期运行。


CAUTION: 激活新的 ILM 策略时， StorageGRID 会使用它来管理所有对象，包括现有对象和新载入的对象。在激活新的 ILM 策略之前，请查看对现有复制对象和纠删编码对象的放置方式所做的任何更改。在评估和实施新放置时，更改现有对象的位置可能会导致临时资源问题。



=== 擦除编码指令发生变化时会发生什么情况

在本示例的当前活动 ILM 策略中，属于租户 A 的对象将在数据中心 1 使用 2+1 纠删编码进行保护。在新建议的 ILM 策略中，属于租户 A 的对象将在数据中心 1 ， 2 和 3 使用 2+1 纠删编码进行保护。

激活新的 ILM 策略后，将执行以下 ILM 操作：

* 租户 A 输入的新对象将拆分为两个数据片段，并添加一个奇偶校验片段。然后，这三个片段中的每一个都会存储在不同的数据中心。
* 属于租户 A 的现有对象将在进行 ILM 扫描过程中重新评估。由于 ILM 放置说明使用新的纠删编码配置文件，因此会创建全新的纠删编码片段并将其分发到三个数据中心。
+

NOTE: 不会重复使用 Data Center 1 上的现有 2+1 片段。StorageGRID 认为每个擦除编码配置文件都是唯一的，使用新配置文件时不会重复使用擦除编码片段。





=== 复制指令发生变化时会发生什么情况

在此示例的当前活动 ILM 策略中，属于其他租户的对象将使用数据中心 1 和 2 的存储池中的两个复制副本进行保护。在新建议的 ILM 策略中，属于其他租户的对象将使用数据中心 1 ， 2 和 3 的存储池中的三个复制副本进行保护。

激活新的 ILM 策略后，将执行以下 ILM 操作：

* 如果租户 A 以外的任何租户载入新对象， StorageGRID 将创建三个副本并在每个数据中心保存一个副本。
* 属于这些其他租户的现有对象将在进行中的 ILM 扫描过程中重新评估。由于数据中心 1 和数据中心 2 上的现有对象副本仍然满足新 ILM 规则的复制要求，因此 StorageGRID 只需要为数据中心 3 创建一个新的对象副本。




=== 激活此策略对性能的影响

激活此示例中建议的 ILM 策略后，此 StorageGRID 系统的整体性能将暂时受到影响。要为租户 A 的现有对象创建新的纠删编码片段，并在数据中心 3 为其他租户的现有对象创建新的复制副本，需要的网格资源级别高于正常水平。

由于 ILM 策略发生更改，客户端读取和写入请求可能会暂时出现比正常延迟高的情况。在整个网格中完全实施放置说明后，延迟将恢复到正常水平。

要在激活新 ILM 策略时避免资源问题，您可以在可能更改大量现有对象位置的任何规则中使用 " 载入时间 " 高级筛选器。将载入时间设置为大于或等于新策略生效的大致时间，以确保现有对象不会发生不必要的移动。


NOTE: 如果在 ILM 策略更改后需要降低或提高对象的处理速度，请联系技术支持。
