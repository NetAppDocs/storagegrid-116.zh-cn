---
permalink: ilm/simulating-ilm-policy.html 
sidebar: sidebar 
keywords: simulate ilm policy 
summary: 在激活测试对象并将其应用于生产数据之前，您应先模拟建议的策略。模拟窗口提供了一个独立的环境，可在激活策略并将其应用于生产环境中的数据之前安全地对策略进行测试。 
---
= 模拟 ILM 策略
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
在激活测试对象并将其应用于生产数据之前，您应先模拟建议的策略。模拟窗口提供了一个独立的环境，可在激活策略并将其应用于生产环境中的数据之前安全地对策略进行测试。

.您需要的内容
* 您将使用登录到网格管理器 xref:../admin/web-browser-requirements.adoc[支持的 Web 浏览器]。
* 您具有特定的访问权限。
* 您知道要测试的每个对象的 S3 存储分段 / 对象密钥或 Swift 容器 / 对象名称，并且您已输入这些对象。


.关于此任务
您必须仔细选择要测试建议策略的对象。要全面模拟策略，您应至少为每个规则中的每个筛选器测试一个对象。

例如，如果某个策略包含一个规则来匹配存储分段 A 中的对象，另一个规则来匹配存储分段 B 中的对象，则必须从存储分段 A 中至少选择一个对象，并从存储分段 B 中选择一个对象来全面测试该策略。您还必须从另一个存储分段中至少选择一个对象，以测试默认规则。

模拟策略时，应考虑以下注意事项：

* 更改策略后，保存建议的策略。然后，模拟已保存的建议策略的行为。
* 模拟策略时，策略中的 ILM 规则会筛选测试对象，以便您可以查看对每个对象应用了哪个规则。但是，不会创建任何对象副本，也不会放置任何对象。运行模拟不会以任何方式修改数据，规则或策略。
* "Simulation" 页面会保留您测试的对象，直到您关闭，导航或刷新 "ILM Policies" 页面为止。
* Simulation 将返回匹配规则的名称。要确定哪个存储池或擦除编码配置文件有效，您可以通过选择规则名称或更多详细信息图标来查看保留图 image:../media/icon_nms_more_details.gif["更多详细信息图标"]。
* 如果启用了 S3 版本控制，则只会根据对象的当前版本模拟策略。


.步骤
. 选择并排列规则，然后保存建议的策略。
+
此示例中的策略有三个规则：

+
[cols="1a,1a,1a,1a"]
|===
| 规则名称 | 筛选器 | 副本类型 | Retention 


 a| 
X-men
 a| 
** 租户 A
** 用户元数据（系列 =x-men ）

 a| 
在两个数据中心创建 2 个副本
 a| 
2 年



 a| 
PNGs
 a| 
密钥以 .png 结尾
 a| 
在两个数据中心创建 2 个副本
 a| 
5 年



 a| 
两个副本两个数据中心
 a| 
无 _
 a| 
在两个数据中心创建 2 个副本
 a| 
永久

|===
+
image::../media/ilm_policies_viewing_proposed.png[ILM 策略查看建议的]

. 使用 S3 或 Swift 客户端或 xref:../tenant/use-s3-console.adoc[S3 控制台处于实验阶段]（可在租户管理器中为每个租户提供），载入测试每个规则所需的对象。
. 选择 * 模拟 * 。
+
此时将显示模拟 ILM 策略对话框。

. 在 * 对象 * 字段中，输入测试对象的 S3 存储分段 / 对象密钥或 Swift 容器 / 对象名称，然后选择 * 模拟 * 。
+
[NOTE]
====
如果指定的对象尚未被载入，则会显示一条消息。

image::../media/object_not_available_for_simulation.gif[指定缺少对象时的消息]

====
. 在 * 模拟结果 * 下，确认每个对象都符合正确的规则。
+
在此示例中， X-men 规则正确匹配了 `Havok.png` 和 `Warpath.jpg` 对象。不包括 `series=x-men` 用户元数据的 `Fullsteap.png` 对象未与 X-men 规则匹配，但已通过 PNGs 规则正确匹配。未使用默认规则，因为这三个对象都与其他规则匹配。

+
image::../media/ilm_policy_simulation_results.gif[模拟结果]





== 示例 1 ：模拟建议的 ILM 策略时验证规则

此示例显示了在模拟建议的策略时如何验证规则。

在此示例中，正在针对两个分段中的输入对象模拟 * 示例 ILM 策略 * 。此策略包括三个规则，如下所示：

* 第一条规则 * 两个副本，即 bucket-A* 两年，仅适用于 bucket-a 中的对象
* 第二条规则 * EC 对象 > 1 MB* ，适用场景 all b桶 but filters on objects 大于 1 MB 。
* 第三条规则为 * 两个副本，两个数据中心 * 。它不包含任何筛选器，也不使用非当前参考时间。


image::../media/saved_policy_for_simulation.png[已保存模拟策略]

.步骤
. 添加规则并保存策略后，选择 * 模拟 * 。
+
此时将显示模拟 ILM 策略对话框。

. 在 * 对象 * 字段中，输入测试对象的 S3 存储分段 / 对象密钥或 Swift 容器 / 对象名称，然后选择 * 模拟 * 。
+
此时将显示模拟结果，其中显示了策略中与您测试的每个对象匹配的规则。

+
image::../media/simulate_policy_screen.png[模拟策略屏幕]

. 确认每个对象均已使用正确的规则进行匹配。
+
在此示例中：

+
.. `bucket-A/bucket-a object.pdf` 与第一个规则正确匹配，该规则会对 `bucket-A` 中的对象进行筛选。
.. `bucket-b/test 对象大于 1 mb.pdf` 位于 `bucket-b` 中，因此与第一条规则不匹配。而是通过第二条规则正确匹配，该规则会对大于 1 MB 的对象进行筛选。
.. `bucket-b/test 对象小于 1 mB.pdf` 与前两个规则中的筛选器不匹配，因此它将由默认规则放置，该规则不包含任何筛选器。






== 示例 2 ：模拟建议的 ILM 策略时重新排列规则

此示例显示了在模拟策略时如何重新排列规则以更改结果。

在此示例中，正在模拟 * 演示 * 策略。此策略用于查找具有 series=x-men 用户元数据的对象，它包含以下三个规则：

* 第一个规则 * PNGs* 会筛选以 ` .png` 结尾的密钥名称。
* 第二条规则 * X-men* 仅适用于租户 A 的对象以及 `series=x-men` 用户元数据的筛选器。
* 最后一条规则 * 两个副本两个数据中心 * 是默认规则，它匹配与前两个规则不匹配的任何对象。


image::../media/simulate_reorder_rules_pngs_rule.png[示例 2 ：模拟建议的 ILM 策略时对规则重新排序]

.步骤
. 添加规则并保存策略后，选择 * 模拟 * 。
. 在 * 对象 * 字段中，输入测试对象的 S3 存储分段 / 对象密钥或 Swift 容器 / 对象名称，然后选择 * 模拟 * 。
+
此时将显示模拟结果，其中显示 `Havok.png` 对象与 * PNGs* 规则匹配。

+
image::../media/simulate_reorder_rules_pngs_result.gif[示例 2 ：模拟建议的 ILM 策略时对规则重新排序]

+
但是， `Havok.png` 对象用于测试的规则是 * X-men* 规则。

. 要解析问题描述 ，请对规则重新排序。
+
.. 选择 * 完成 * 以关闭模拟 ILM 策略页面。
.. 选择 * 编辑 * 以编辑策略。
.. 将 *X-men* 规则拖动到列表顶部。
+
image::../media/simulate_reorder_rules_correct_rule.png[模拟 - 重新排列规则 - 更正规则]

.. 选择 * 保存 * 。


. 选择 * 模拟 * 。
+
系统会根据更新后的策略重新评估先前测试的对象，并显示新的模拟结果。在此示例中， Rule matched 列显示 `Havok.png` 对象现在与 X-men 元数据规则匹配，如预期。上一个匹配列显示 PNGs 规则与上一个模拟中的对象匹配。

+
image::../media/simulate_reorder_rules_correct_result.gif[示例 2 ：模拟建议的 ILM 策略时对规则重新排序]

+

NOTE: 如果您停留在配置策略页面上，则可以在进行更改后重新模拟策略，而无需重新输入测试对象的名称。





== 示例 3 ：模拟建议的 ILM 策略时更正规则

此示例显示了如何模拟策略，更正策略中的规则以及继续模拟。

在此示例中，正在模拟 * 演示 * 策略。此策略用于查找具有 `series=x-men` 用户元数据的对象。但是，在针对 `Beast.jpg` 对象模拟此策略时，会出现意外结果。该对象与默认规则匹配，而不是与 X-men 元数据规则匹配，而是复制两个数据中心。

image::../media/simulate_results_for_object_wrong_metadata.png[示例 3 ：模拟建议的 ILM 策略时更正规则]

如果测试对象与策略中的预期规则不匹配，则必须检查策略中的每个规则并更正任何错误。

.步骤
. 对于策略中的每个规则，选择规则名称或更多详细信息图标以查看规则设置 image:../media/icon_nms_more_details.gif["更多详细信息图标"] 显示规则的任何对话框上。
. 查看规则的租户帐户，参考时间和筛选条件。
+
在此示例中， X-men 规则的元数据包含错误。元数据值输入为 "`x-men1` " ，而不是 "`x-men.` "

+
image::../media/simulate_rules_select_rule_popup_with_wrong_metadata.png[示例 3 ：模拟建议的 ILM 策略时更正规则]

. 要解决此错误，请按如下所示更正此规则：
+
** 如果规则是建议策略的一部分，则可以克隆此规则，也可以从策略中删除此规则，然后对其进行编辑。
** 如果规则是活动策略的一部分，则必须克隆此规则。您不能编辑活动策略中的规则或将其从活动策略中删除。
+
[cols="1a,3a"]
|===
| 选项 | Description 


 a| 
克隆规则
 a| 
... 选择 * ILM * > * 规则 * 。
... 选择不正确的规则，然后选择 * 克隆 * 。
... 更改不正确的信息，然后选择 * 保存 * 。
... 选择 * ILM * > * 策略 * 。
... 选择建议的策略，然后选择 * 编辑 * 。
... 选择 * 选择规则 * 。
... 选中新规则的复选框，取消选中原始规则的复选框，然后选择 * 应用 * 。
... 选择 * 保存 * 。




 a| 
编辑规则
 a| 
... 选择建议的策略，然后选择 * 编辑 * 。
... 选择删除图标 image:../media/icon_nms_delete_new.gif["删除图标"] 要删除不正确的规则，请选择 * 保存 * 。
... 选择 * ILM * > * 规则 * 。
... 选择不正确的规则，然后选择 * 编辑 * 。
... 更改不正确的信息，然后选择 * 保存 * 。
... 选择 * ILM * > * 策略 * 。
... 选择建议的策略，然后选择 * 编辑 * 。
... 选择更正后的规则，选择 * 应用 * ，然后选择 * 保存 * 。


|===


. 再次执行模拟。
+

NOTE: 由于您导航出 "ILM Policies" 页面以编辑此规则，因此先前为模拟输入的对象将不再显示。您必须重新输入对象的名称。

+
在本示例中，更正后的 X-men 规则现在会根据 `series=x-men` 用户元数据与 `Beast.jpg` 对象匹配，如预期。

+
image::../media/simulate_results_for_object_corrected_metadata.gif[示例 3 ：模拟建议的 ILM 策略时更正规则]


