---
permalink: ilm/step-2-of-3-define-placements.html 
sidebar: sidebar 
keywords: ilm rule step 2, define placements 
summary: 通过创建 ILM 规则向导的第 2 步 \ （定义放置位置 \ ），您可以定义放置说明，以确定对象的存储时间，副本类型（复制或擦除编码 \ ），存储位置以及副本数量。 
---
= 第 2 步，共 3 步：定义放置位置
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
通过创建 ILM 规则向导的第 2 步（定义放置位置），您可以定义放置说明，以确定对象的存储时间，副本的类型（复制或擦除编码），存储位置以及副本数量。

.关于此任务
一个 ILM 规则可以包含一个或多个放置指令。每个放置指令适用场景 都有一段时间。如果使用多个指令，则时间段必须是连续的，并且至少有一个指令必须从第 0 天开始。这些说明可以永久继续，也可以一直持续到不再需要任何对象副本为止。

如果要在该时间段内创建不同类型的副本或使用不同的位置，则每个放置指令可以包含多行。

此示例 ILM 规则会为第一年创建两个复制副本。每个副本都保存在不同站点的存储池中。一年后，将创建 2+1 纠删编码副本，并仅保存在一个站点上。

image::../media/ilm_create_ilm_rule_wizard_2.png[创建 ILM 规则向导第 2 页]

.步骤
. 对于 * 参考时间 * ，选择计算放置指令的开始时间时要使用的时间类型。
+
[cols="1a,2a"]
|===
| 选项 | Description 


 a| 
载入时间
 a| 
对象的载入时间。



 a| 
上次访问时间
 a| 
上次检索（读取或查看）对象的时间。

* 注意： * 要使用此选项，必须为 S3 存储分段或 Swift 容器启用上次访问时间更新。请参见 xref:using-last-access-time-in-ilm-rules.adoc[在 ILM 规则中使用上次访问时间]。



 a| 
非当前时间
 a| 
对象版本因载入新版本并替换为当前版本而变为非最新的时间。

* 注： * 非当前时间仅适用于已启用版本控制的存储分段中的 S3 对象。

您可以使用此选项通过筛选非当前对象版本来减少受版本控制的对象的存储影响。请参见 xref:example-4-ilm-rules-and-policy-for-s3-versioned-objects.adoc[示例 4 ： S3 版本对象的 ILM 规则和策略]。



 a| 
用户定义的创建时间
 a| 
在用户定义的元数据中指定的时间。

|===
+

NOTE: 如果要创建合规规则，必须选择 * 载入时间 * 。

. 在 * 放置位置 * 部分中，选择第一个时间段的开始时间和持续时间。
+
例如，您可能需要指定第一年对象的存储位置（ " `day 0 for 365 days` " ）。至少有一个指令必须从第 0 天开始。

. 如果要创建复制的副本：
+
.. 从 * 类型 * 下拉列表中，选择 * 已复制 * 。
.. 在 * 位置 * 字段中，为要添加的每个存储池选择 * 添加池 * 。
+
* 如果仅指定一个存储池 * ，请注意， StorageGRID 只能在任何给定存储节点上存储一个对象的一个复制副本。如果网格包含三个存储节点，并且您选择 4 作为副本数，则只会创建三个副本—每个存储节点一个副本。

+

NOTE: 系统将触发 * 无法实现 ILM 放置 * 警报，以指示无法完全应用 ILM 规则。

+
* 如果指定多个存储池 * ，请记住以下规则：

+
*** 副本数量不能大于存储池数量。
*** 如果副本数等于存储池数，则每个存储池中将存储一个对象副本。
*** 如果副本数小于存储池数，则系统会分发这些副本，以便在池之间保持磁盘使用量的平衡，同时确保任何站点都不会获得一个对象的多个副本。
*** 如果存储池重叠（包含相同的存储节点），则对象的所有副本可能只保存在一个站点上。因此，请勿指定默认的所有存储节点存储池和另一个存储池。
+
image::../media/ilm_rule_with_multiple_storage_pools.png[多个存储池的放置说明]



.. 选择要创建的副本数。
+
如果将副本数更改为 1 ，则会显示一条警告。如果 ILM 规则在任何时间段内仅创建一个复制副本，则会使数据面临永久丢失的风险。请参见 xref:why-you-should-not-use-single-copy-replication.adoc[为什么不应使用单副本复制]。

+
image::../media/ilm_create_ilm_rule_warning_for_1_copy.png[为 1 个副本创建 ILM 规则第 2 页警告]

+
要避免这些风险，请执行以下一项或多项操作：

+
*** 增加时间段内的副本数。
*** 选择加号图标 image:../media/icon_plus_sign_black_on_white.gif["加号为黑色，呈白色显示"] 在此时间段内创建其他副本。然后，选择其他存储池或云存储池。
*** 选择 "Erasure Coded* " 作为 "Type" ，而不是 "* 已复制 * 。如果此规则已在所有时间段创建多个副本，则可以安全地忽略此警告。


.. 如果仅指定一个存储池，请忽略 * 临时位置 * 字段。
+

NOTE: 临时位置已弃用，将在未来版本中删除。请参见 xref:using-storage-pool-as-temporary-location-deprecated.adoc[使用存储池作为临时位置（已弃用）]。



. 如果要创建经过纠删编码的副本：
+
.. 从 * 类型 * 下拉列表中，选择 * 纠删编码 * 。
+
副本数将更改为 1 。如果规则没有高级筛选器来忽略 200 KB 或更小的对象，则会显示警告。

+
image::../media/ilm_rule_warning_for_ec_size.png[针对 EC 大小的 ILM 规则警告]

+

IMPORTANT: 纠删编码最适合大于 1 MB 的对象。请勿对小于 200 KB 的对象使用纠删编码，以避免管理极小的纠删编码片段所产生的开销。

.. 如果出现对象大小警告，请选择 * 返回 * 以返回到步骤 1 。然后，选择 * 高级筛选 * 并将对象大小（ MB ）筛选器设置为大于 0.2 的任何值。
.. 选择存储位置。
+
擦除编码副本的存储位置包括存储池的名称，后跟擦除编码配置文件的名称。

+
image::../media/storage_pool_and_erasure_coding_profile.png[存储池和 EC 配置文件名称]



. 或者，也可以在不同位置添加不同的时间段或创建其他副本：
+
** 选择加号图标可在同一时间段内在其他位置创建其他副本。
** 选择 * 添加 * 可为放置说明添加不同的时间段。
+

NOTE: 除非最后一个时间段以 * 永久 * 结束，否则对象将在最后一个时间段结束时自动删除。



. 如果要将对象存储在云存储池中：
+
.. 从 * 类型 * 下拉列表中，选择 * 已复制 * 。
.. 在 * 位置 * 字段中，选择 * 添加池 * 。然后，选择一个云存储池。
+
image::../media/ilm_cloud_storage_pool.gif[将云存储池添加到放置说明]

+
使用云存储池时，请记住以下规则：

+
*** 您不能在一个放置指令中选择多个云存储池。同样，您也不能在同一放置指令中选择云存储池和存储池。
+
image::../media/ilm_cloud_storage_pool_error.gif[ILM 规则 > 云存储池错误]

*** 您只能在任何给定的云存储池中存储一个对象的一个副本。如果将 * 副本 * 设置为 2 或更多，则会显示一条错误消息。
+
image::../media/ilm_cloud_storage_pool_error_one_copy.gif[ILM 规则：如果有多个副本，则显示云存储池错误]

*** 不能同时在任何云存储池中存储多个对象副本。如果使用云存储池的多个放置位置的日期重叠，或者同一放置中的多个行使用云存储池，则会显示错误消息。
+
image::../media/ilm_rule_cloud_storage_pool_error_overlapping_dates.png[ILM 规则云存储池错误日期重叠]

*** 您可以将对象存储在云存储池中，同时将该对象存储为 StorageGRID 中的复制副本或纠删编码副本。但是，如本示例所示，您必须在时间段的放置说明中包含多行内容，以便为每个位置指定副本的数量和类型。
+
image::../media/ilm_cloud_storage_pool_multiple_locations.png[ILM 规则 > 云存储池和其他位置]





. 选择 * 刷新 * 以更新保留示意图并确认放置说明。
+
图中的每一行都显示了对象副本放置的位置和时间。副本类型由以下图标之一表示：

+
[cols="1a,2a"]
|===


 a| 
image:../media/icon_nms_replicated.gif["复制副本图标"]
 a| 
复制的副本



 a| 
image:../media/icon_nms_erasure_coded.gif["擦除编码副本图标"]
 a| 
经过纠删编码的副本



 a| 
image:../media/icon_cloud_storage_pool.gif["Cloud Storage Pool 图标"]
 a| 
云存储池副本

|===
+
在此示例中，两个复制副本将保存到两个存储池（ DC1 和 DC2 ）中一年。然后，在三个站点上使用 6+3 纠删编码方案，再将经过纠删编码的副本保存 10 年。11 年后，这些对象将从 StorageGRID 中删除。

+
image::../media/ilm_rule_retention_diagram.png[ILM 规则保留图]

. 选择 * 下一步 * 。
+
此时将显示第 3 步（定义载入行为）。



.相关信息
* xref:what-ilm-rule-is.adoc[什么是 ILM 规则]
* xref:managing-objects-with-s3-object-lock.adoc[使用 S3 对象锁定管理对象]
* xref:step-3-of-3-define-ingest-behavior.adoc[第 3 步，共 3 步：定义载入行为]

