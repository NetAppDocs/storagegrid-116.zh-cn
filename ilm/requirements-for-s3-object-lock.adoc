---
permalink: ilm/requirements-for-s3-object-lock.html 
sidebar: sidebar 
keywords: requirements, s3 object lock 
summary: 您必须查看启用全局 S3 对象锁定设置的要求，创建合规 ILM 规则和 ILM 策略的要求以及 StorageGRID 对使用 S3 对象锁定的分段和对象所施加的限制。 
---
= S3 对象锁定的要求
:icons: font
:imagesdir: ../media/


[role="lead"]
您必须查看启用全局 S3 对象锁定设置的要求，创建合规 ILM 规则和 ILM 策略的要求以及 StorageGRID 对使用 S3 对象锁定的分段和对象所施加的限制。



== 使用全局 S3 对象锁定设置的要求

* 您必须先使用网格管理器或网格管理 API 启用全局 S3 对象锁定设置，然后任何 S3 租户才能创建启用了 S3 对象锁定的分段。
* 启用全局 S3 对象锁定设置后，所有 S3 租户帐户都可以在启用了 S3 对象锁定的情况下创建存储分段。
* 启用全局 S3 对象锁定设置后，您将无法禁用此设置。
* 除非活动 ILM 策略中的默认规则为 _compliant_ （即，默认规则必须符合启用了 S3 对象锁定的分段的要求），否则无法启用全局 S3 对象锁定。
* 启用全局 S3 对象锁定设置后，除非策略中的默认规则合规，否则您无法创建新的建议 ILM 策略或激活现有建议的 ILM 策略。启用全局 S3 对象锁定设置后， "ILM 规则 " 和 "ILM 策略 " 页面将指示符合哪些 ILM 规则。
+
在以下示例中， "ILM 规则 " 页面列出了与启用了 S3 对象锁定的存储分段兼容的三个规则。

+
image::../media/compliance_fields_on_ilm_rules_page.png[ILM 规则页面上的合规性字段]





== 符合 ILM 规则的要求

如果要启用全局 S3 对象锁定设置，必须确保活动 ILM 策略中的默认规则合规。合规规则可满足启用了 S3 对象锁定的两个存储分段以及启用了旧合规性的任何现有存储分段的要求：

* 它必须至少创建两个复制的对象副本或一个经过纠删编码的副本。
* 这些副本必须在放置说明中每行的整个持续时间内存在于存储节点上。
* 对象副本无法保存在云存储池中。
* 无法将对象副本保存在归档节点上。
* 放置说明中至少有一行必须从第 0 天开始，并使用 * 载入时间 * 作为参考时间。
* 放置说明中至少一行必须为 "`forever 。` "


例如，此规则满足启用了 S3 对象锁定的分段的要求。它会存储从载入时间（第 0 天）到 "`Forever " 的两个复制对象副本。` 这些对象将存储在两个数据中心的存储节点上。

image::../media/compliant_rule_two_copies_forever.png[示例符合规则两个永久副本]



== 活动的和建议的 ILM 策略的要求

启用全局 S3 对象锁定设置后，活动和建议的 ILM 策略可以同时包含合规和不合规的规则。

* 活动 ILM 策略或任何建议 ILM 策略中的默认规则必须合规。
* 不合规规则仅适用于未启用 S3 对象锁定或未启用原有合规功能的分段中的对象。
* 合规规则可以应用于任何存储分段中的对象；不需要为此存储分段启用 S3 对象锁定或原有合规性。


合规的 ILM 策略可能包括以下三个规则：

. 一种在启用了 S3 对象锁定的情况下为特定分段中的对象创建经过擦除编码的副本的合规规则。EC 副本从第 0 天一直存储在存储节点上。
. 一种不合规的规则，在存储节点上创建两个复制的对象副本一年，然后将一个对象副本移动到归档节点并永久存储该副本。此规则仅适用于未启用 S3 对象锁定或原有合规性的适用场景 分段，因为它仅永久存储一个对象副本，并且使用归档节点。
. 一种默认的合规规则，用于在存储节点上创建从 0 天到永久的两个复制对象副本。此规则适用场景 任何分段中未被前两个规则筛选出的任何对象。




== 启用了 S3 对象锁定的存储分段的要求

* 如果为 StorageGRID 系统启用了全局 S3 对象锁定设置，则可以使用租户管理器，租户管理 API 或 S3 REST API 创建启用了 S3 对象锁定的分段。
+
此租户管理器示例显示了一个已启用 S3 对象锁定的存储分段。

+
image::../media/compliant_bucket.png[合规存储分段示例]

* 如果您计划使用 S3 对象锁定，则必须在创建存储分段时启用 S3 对象锁定。您不能为现有存储分段启用 S3 对象锁定。
* S3 对象锁定需要分段版本。为存储分段启用 S3 对象锁定后， StorageGRID 会自动为该存储分段启用版本控制。
* 在启用了 S3 对象锁定的情况下创建存储分段后，无法禁用 S3 对象锁定或暂停该存储分段的版本控制。
* 您也可以为存储分段配置默认保留。上传对象版本时，默认保留将应用于对象版本。您可以通过在上传对象版本的请求中指定保留模式和保留至日期来覆盖存储分段默认值。
* S3 对象生命周期分段支持分段生命周期配置。
* 启用了 S3 对象锁定的存储分段不支持 CloudMirror 复制。




== 启用了 S3 对象锁定的分段中的对象的要求

* 要保护对象版本， S3 客户端应用程序必须配置存储分段默认保留，或者在每个上传请求中指定保留设置。
* 您可以增加对象版本的保留截止日期，但不能减小此值。
* 如果您收到有关待定法律诉讼或监管调查的通知，则可以通过对对象版本进行法律保留来保留相关信息。如果对象版本处于合法保留状态，则无法从 StorageGRID 中删除该对象，即使该对象已达到保留日期。一旦取消合法保留，如果已达到保留日期，则可以删除对象版本。
* S3 对象锁定需要使用版本控制的分段。保留设置适用于各个对象版本。对象版本可以同时具有保留截止日期和合法保留设置，但不能具有其他设置，或者两者均不具有。为对象指定保留日期或合法保留设置仅保护请求中指定的版本。您可以创建新版本的对象，而先前版本的对象仍保持锁定状态。




== 启用了 S3 对象锁定的存储分段中的对象生命周期

保存在启用了 S3 对象锁定的存储分段中的每个对象将经历三个阶段：

. * 对象载入 *
+
** 在启用了 S3 对象锁定的情况下向存储分段添加对象版本时， S3 客户端应用程序可以使用默认存储分段保留设置，也可以指定对象的保留设置（保留至日期，合法保留或两者）。然后， StorageGRID 会为此对象生成元数据，其中包括唯一对象标识符（ UUID ）以及载入日期和时间。
** 载入具有保留设置的对象版本后，将无法修改其数据和 S3 用户定义的元数据。
** StorageGRID 存储的对象元数据与对象数据无关。它会为每个站点上的所有对象元数据维护三个副本。


. * 对象保留 *
+
** StorageGRID 会存储该对象的多个副本。副本的确切数量和类型以及存储位置取决于活动 ILM 策略中的合规规则。


. * 对象删除 *
+
** 达到保留截止日期后，可以删除对象。
** 无法删除处于合法保留状态的对象。




.相关信息
* xref:../tenant/index.adoc[使用租户帐户]
* xref:../s3/index.adoc[使用 S3]
* xref:managing-objects-with-s3-object-lock.adoc#comparing-s3-object-lock-to-legacy-compliance[比较 S3 对象锁定与原有合规性]
* xref:example-7-compliant-ilm-policy-for-s3-object-lock.adoc[示例 7 ： S3 对象锁定的兼容 ILM 策略]
* xref:../audit/index.adoc[查看审核日志]
* xref:../s3/operations-on-buckets.adoc#using-s3-object-lock-default-bucket-retention[使用 S3 对象锁定默认存储分段保留]。

