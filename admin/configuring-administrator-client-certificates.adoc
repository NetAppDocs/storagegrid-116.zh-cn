---
permalink: admin/configuring-administrator-client-certificates.html 
sidebar: sidebar 
keywords: client certificates, prometheus 
summary: 客户端证书允许授权的外部客户端访问 StorageGRID Prometheus 数据库，从而为外部工具监控 StorageGRID 提供了一种安全的方式。 
---
= 配置客户端证书
:icons: font
:imagesdir: ../media/


[role="lead"]
客户端证书允许授权的外部客户端访问 StorageGRID Prometheus 数据库，从而为外部工具监控 StorageGRID 提供了一种安全的方式。

如果您需要使用外部监控工具访问 StorageGRID ，则必须使用网格管理器上传或生成管理员客户端证书，并将证书信息复制到外部工具。

请参见有关的信息 xref:using-storagegrid-security-certificates.adoc[常规安全证书用途] 和 xref:configuring-custom-server-certificate-for-grid-manager-tenant-manager.adoc[配置自定义服务器证书]。


NOTE: 为了确保操作不会因服务器证书失败而中断，当此服务器证书即将到期时，系统将触发 " 证书 " 页面上配置的 * 客户端证书到期 " 警报。根据需要，您可以通过选择 * 配置 * > * 安全性 * > * 证书 * 并在客户端选项卡上查看客户端证书的到期日期来查看当前证书的到期时间。


NOTE: 如果您使用密钥管理服务器（ KMS ）保护专门配置的设备节点上的数据，请参见有关的特定信息 xref:kms-adding.adoc[上传 KMS 客户端证书]。

.您需要什么？ #8217 ；将需要什么
* 您具有 root 访问权限。
* 您将使用登录到网格管理器 xref:../admin/web-browser-requirements.adoc[支持的 Web 浏览器]。
* 配置客户端证书：
+
** 您拥有管理节点的 IP 地址或域名。
** 您已配置 StorageGRID 管理接口证书并具有相应的可选 CA 包。
** 要上传您自己的证书，您的本地计算机上提供了证书的公有 密钥和专用密钥。


* 编辑客户端证书：
+
** 您拥有管理节点的 IP 地址或域名。
** 要上传新证书和私钥，您的本地计算机上提供了证书的公有 密钥和私钥。






== 添加客户端证书

要添加管理员客户端证书，您可以提供自己的证书或使用网格管理器生成一个证书。

.步骤
. 在网格管理器中，选择 * 配置 * > * 安全性 * > * 证书 * ，然后选择 * 客户端 * 选项卡。
. 选择 * 添加 * 。
. 输入一个介于 1 到 32 个字符之间的证书名称。
. 要使用外部监控工具访问 Prometheus 指标，请选择 * 允许 Prometheus* 。
. 在 * 证书类型 * 部分中，上传或生成证书。
+
[role="tabbed-block"]
====
.上传证书
--
上传证书 ` .pem` 文件。

.. 选择 * 上传证书 * ，然后选择 * 继续 * 。
.. 上传客户端证书名称（` .pem` ）。
+
选择 * 客户端证书详细信息 * 以显示证书元数据和证书 PEM 。

+
*** 选择 * 下载证书 * 以保存证书文件。
+
指定证书文件名和下载位置。使用扩展名 ` .pem` 保存文件。

+
例如： `storagegRid_certificate.pem`

*** 选择 * 复制证书 PEM* 将证书内容复制到其他位置进行粘贴。


.. 选择 * 创建 * 以在网格管理器中保存证书。
+
新证书将显示在客户端选项卡上。



--
.生成证书
--
生成要粘贴到其他位置的证书文本。

.. 选择 * 生成证书 * 。
.. 指定证书信息：
+
*** * 域名 * ：要包含在证书中的一个或多个完全限定域名。使用 * 作为通配符表示多个域名。
*** * IP * ：要包含在证书中的一个或多个 IP 地址。
*** * 主题 * ：证书所有者的 X.509 主题或可分辨名称（ DN ）。
*** * 有效天数 * ：创建证书后的天数到期。


.. 选择 * 生成 * 。
.. 选择 * 客户端证书详细信息 * 以显示证书元数据和证书 PEM 。
+

IMPORTANT: 关闭此对话框后，您将无法查看此证书专用密钥。将密钥复制或下载到安全位置。

+
*** 选择 * 复制证书 PEM* 将证书内容复制到其他位置进行粘贴。
*** 选择 * 下载证书 * 以保存证书文件。
+
指定证书文件名和下载位置。使用扩展名 ` .pem` 保存文件。

+
例如： `storagegRid_certificate.pem`

*** 选择 * 复制私钥 * 可复制证书私钥以粘贴到其他位置。
*** 选择 * 下载私钥 * 将私钥另存为文件。
+
指定私钥文件名和下载位置。



.. 选择 * 创建 * 以在网格管理器中保存证书。
+
新证书将显示在客户端选项卡上。



--
====
. 在外部监控工具上配置以下设置，例如 Grafana 。
+
以下屏幕截图显示了一个 Grafana 示例：

+
image::../media/grafana_add_url_and_auth.png[Grafana —添加 URL 和身份验证]

+
.. * 名称 * ：输入连接的名称。
+
StorageGRID 不需要此信息，但您必须提供一个名称来测试连接。

.. * URL * ：输入管理节点的域名或 IP 地址。指定 HTTPS 和端口 9091 。
+
例如： ` + https://admin-node.example.com:9091+`

.. 启用 * TLS 客户端身份验证 * 和 * 使用 CA 证书 * 。
.. 将管理接口证书或可选 CA 包复制并粘贴到 TLS/SSL 身份验证详细信息下的 "CA 证书 " 中。
.. * 服务器名称 * ：输入管理节点的域名。
+
servername 必须与管理接口证书中显示的域名匹配。

.. 保存并测试从 StorageGRID 或本地文件复制的证书和私钥。
+
现在，您可以使用外部监控工具从 StorageGRID 访问 Prometheus 指标。

+
有关指标的信息，请参见 xref:../monitor/index.adoc[有关监控 StorageGRID 的说明]。







== 编辑客户端证书

您可以编辑管理员客户端证书以更改其名称，启用或禁用 Prometheus 访问，或者在当前证书已过期时上传新证书。

.步骤
. 选择 * 配置 * > * 安全性 * > * 证书 * ，然后选择 * 客户端 * 选项卡。
+
表中列出了证书到期日期和 Prometheus 访问权限。如果证书即将过期或已过期，则表中会显示一条消息并触发警报。

. 选择要编辑的证书。
. 选择 * 编辑 * ，然后选择 * 编辑名称和权限 *
. 输入一个介于 1 到 32 个字符之间的证书名称。
. 要使用外部监控工具访问 Prometheus 指标，请选择 * 允许 Prometheus* 。
. 选择 * 继续 * 以在网格管理器中保存证书。
+
更新后的证书将显示在客户端选项卡上。





== 附加新的客户端证书

您可以在当前证书过期后上传新证书。

.步骤
. 选择 * 配置 * > * 安全性 * > * 证书 * ，然后选择 * 客户端 * 选项卡。
+
表中列出了证书到期日期和 Prometheus 访问权限。如果证书即将过期或已过期，则表中会显示一条消息并触发警报。

. 选择要编辑的证书。
. 选择 * 编辑 * ，然后选择编辑选项。
+
[role="tabbed-block"]
====
.上传证书
--
复制证书文本以粘贴到其他位置。

.. 选择 * 上传证书 * ，然后选择 * 继续 * 。
.. 上传客户端证书名称（` .pem` ）。
+
选择 * 客户端证书详细信息 * 以显示证书元数据和证书 PEM 。

+
*** 选择 * 下载证书 * 以保存证书文件。
+
指定证书文件名和下载位置。使用扩展名 ` .pem` 保存文件。

+
例如： `storagegRid_certificate.pem`

*** 选择 * 复制证书 PEM* 将证书内容复制到其他位置进行粘贴。


.. 选择 * 创建 * 以在网格管理器中保存证书。
+
更新后的证书将显示在客户端选项卡上。



--
.生成证书
--
生成要粘贴到其他位置的证书文本。

.. 选择 * 生成证书 * 。
.. 指定证书信息：
+
*** * 域名 * ：要包含在证书中的一个或多个完全限定域名。使用 * 作为通配符表示多个域名。
*** * IP * ：要包含在证书中的一个或多个 IP 地址。
*** * 主题 * ：证书所有者的 X.509 主题或可分辨名称（ DN ）。
*** * 有效天数 * ：创建证书后的天数到期。


.. 选择 * 生成 * 。
.. 选择 * 客户端证书详细信息 * 以显示证书元数据和证书 PEM 。
+

IMPORTANT: 关闭此对话框后，您将无法查看此证书专用密钥。将密钥复制或下载到安全位置。

+
*** 选择 * 复制证书 PEM* 将证书内容复制到其他位置进行粘贴。
*** 选择 * 下载证书 * 以保存证书文件。
+
指定证书文件名和下载位置。使用扩展名 ` .pem` 保存文件。

+
例如： `storagegRid_certificate.pem`

*** 选择 * 复制私钥 * 可复制证书私钥以粘贴到其他位置。
*** 选择 * 下载私钥 * 将私钥另存为文件。
+
指定私钥文件名和下载位置。



.. 选择 * 创建 * 以在网格管理器中保存证书。
+
新证书将显示在客户端选项卡上。



--
====




== 下载或复制客户端证书

您可以下载或复制客户端证书以供其他位置使用。

.步骤
. 选择 * 配置 * > * 安全性 * > * 证书 * ，然后选择 * 客户端 * 选项卡。
. 选择要复制或下载的证书。
. 下载或复制证书。
+
[role="tabbed-block"]
====
.下载证书文件
--
下载证书 ` .pem` 文件。

.. 选择 * 下载证书 * 。
.. 指定证书文件名和下载位置。使用扩展名 ` .pem` 保存文件。
+
例如： `storagegRid_certificate.pem`



--
.复制证书
--
复制证书文本以粘贴到其他位置。

.. 选择 * 复制证书 PEM* 。
.. 将复制的证书粘贴到文本编辑器中。
.. 保存扩展名为 ` .pem` 的文本文件。
+
例如： `storagegRid_certificate.pem`



--
====




== 删除客户端证书

如果您不再需要管理员客户端证书，可以将其删除。

.步骤
. 选择 * 配置 * > * 安全性 * > * 证书 * ，然后选择 * 客户端 * 选项卡。
. 选择要删除的证书。
. 选择 * 删除 * ，然后确认。



NOTE: 要删除最多 10 个证书，请在客户端选项卡上选择要删除的每个证书，然后选择 * 操作 * > * 删除 * 。

删除证书后，使用该证书的客户端必须指定一个新的客户端证书，才能访问 StorageGRID Prometheus 数据库。
