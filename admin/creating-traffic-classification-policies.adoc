---
permalink: admin/creating-traffic-classification-policies.html 
sidebar: sidebar 
keywords: traffic classification, network traffic, traffic limits, policy 
summary: 如果要按分段，租户， IP 子网或负载平衡器端点监控网络流量，并可选择限制此流量，则可以创建流量分类策略。您也可以根据带宽，并发请求数或请求率为策略设置限制。 
---
= 创建流量分类策略
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果要按分段，租户， IP 子网或负载平衡器端点监控网络流量，并可选择限制此流量，则可以创建流量分类策略。您也可以根据带宽，并发请求数或请求率为策略设置限制。

.您需要的内容
* 您将使用登录到网格管理器 xref:../admin/web-browser-requirements.adoc[支持的 Web 浏览器]。
* 您具有 root 访问权限。
* 您已创建要匹配的任何负载平衡器端点。
* 您已创建要匹配的任何租户。


.步骤
. 选择 * 配置 * > * 网络 * > * 流量分类 * 。
+
此时将显示 " 流量分类策略 " 页面。

+
image::../media/traffic_classification_policies_main_screen.png[流量分类策略—主屏幕]

. 选择 * 创建 * 。
+
此时将显示创建流量分类策略对话框。

+
image::../media/traffic_classification_policy_create.png[流量分类策略—创建]

. 在 * 名称 * 字段中，输入策略的名称。
+
输入描述性名称，以便识别策略。

. 也可以在 * 问题描述 * 字段中为策略添加问题描述 。
+
例如，描述此流量分类策略适用场景 及其限制。

. 为策略创建一个或多个匹配规则。
+
匹配规则控制哪些实体将受此流量分类策略的影响。例如，如果要将此策略应用于特定租户的网络流量，请选择租户。或者，如果要将此策略应用于特定负载平衡器端点上的网络流量，请选择 Endpoint 。

+
.. 在 * 匹配规则 * 部分中选择 * 创建 * 。
+
此时将显示创建匹配规则对话框。

+
image::../media/traffic_classification_policy_create_matching_rule.png[创建匹配规则]

.. 从 * 类型 * 下拉列表中，选择要包含在匹配规则中的实体类型。
.. 在 * 匹配值 * 字段中，根据您选择的实体类型输入匹配值。
+
*** 存储分段：输入存储分段名称。
*** Bucket Rex ：输入用于匹配一组存储分段名称的正则表达式。
+
正则表达式已取消锁定。使用 ｛ caret ｝ 定位点在存储分段名称开头匹配，并使用 $ 定位点在存储分段名称末尾匹配。

*** CIDR ：以 CIDR 表示法输入与所需子网匹配的 IPv4 子网。
*** Endpoint ：从现有端点列表中选择一个端点。这些是您在负载平衡器端点页面上定义的负载平衡器端点。请参见 xref:configuring-load-balancer-endpoints.adoc[配置负载平衡器端点]。
*** 租户：从现有租户列表中选择一个租户。租户匹配取决于所访问的存储分段的所有权。对存储分段的匿名访问与拥有存储分段的租户匹配。


.. 如果要匹配与刚刚定义的类型和匹配值一致的所有网络流量 _except _ 流量，请选中 * 反向 * 复选框。否则，请取消选中此复选框。
+
例如，如果要将此策略应用于除一个负载平衡器端点之外的所有其他端点，请指定要排除的负载平衡器端点，然后选择 * 反向 * 。

+

IMPORTANT: 对于包含多个匹配器且至少有一个是反向匹配器的策略，请注意不要创建与所有请求匹配的策略。

.. 选择 * 应用 * 。
+
此时将创建此规则，并将其列在匹配规则表中。

+
image::../media/traffic_classification_policy_rules.png[流量策略匹配规则]

.. 对要为策略创建的每个规则重复上述步骤。
+

NOTE: 与任何规则匹配的流量由策略处理。



. 也可以为策略创建限制。
+

NOTE: 即使不创建限制， StorageGRID 也会收集指标，以便监控与策略匹配的网络流量。

+
.. 在 * 限制 * 部分中选择 * 创建 * 。
+
此时将显示创建限制对话框。

+
image::../media/traffic_classification_policy_create_limit.png[创建限制]

.. 从 * 类型 * 下拉列表中，选择要应用于策略的限制类型。
+
在以下列表中， * 输入 * 是指从 S3 或 Swift 客户端到 StorageGRID 负载平衡器的流量， * 输出 * 是指从负载平衡器到 S3 或 Swift 客户端的流量。

+
*** 中的聚合带宽
*** 聚合带宽不足
*** 并发读取请求
*** 并发写入请求
*** 每个请求的带宽
*** 每个请求的带宽不足
*** 读取请求速率
*** 写入请求速率
+
[NOTE]
====
您可以创建策略来限制聚合带宽或限制每个请求的带宽。但是， StorageGRID 不能同时限制这两种类型的带宽。聚合带宽限制可能会对非受限流量产生额外的轻微性能影响。

====
+
对于带宽限制， StorageGRID 会应用与设置的限制类型最匹配的策略。例如，如果您的策略仅限制一个方向的流量，则相反方向的流量将是无限制的，即使存在与具有带宽限制的其他策略匹配的流量也是如此。StorageGRID 按以下顺序实施 "`最佳` " 匹配的带宽限制：

+
**** 确切的 IP 地址（ /32 掩码）
**** 确切的存储分段名称
**** 分段正则表达式
**** 租户
**** 端点
**** 非精确的 CIDR 匹配项（非 /32 ）
**** 反向匹配




.. 在 * 值 * 字段中，输入所选限制类型的数值。
+
选择限制时，系统将显示预期单位。

.. 选择 * 应用 * 。
+
此时将创建此限制，并将其列在限制表中。

+
image::../media/traffic_classification_policy_limits.png[流量策略限制]

.. 对要添加到策略中的每个限制重复上述步骤。
+
例如，如果要为 SLA 层创建 40 Gbps 带宽限制，请创建 " 聚合带宽限制 " 和 " 聚合带宽超限 " ，并将每个限制设置为 40 Gbps 。

+

NOTE: 要将每秒兆字节数转换为每秒千兆位数，请乘以 8 。例如， 125 MB/ 秒相当于 1 ， 000 Mbps 或 1 Gbps 。



. 创建完规则和限制后，请选择 * 保存 * 。
+
此策略将保存并列出在 " 流量分类策略 " 表中。

+
image::../media/traffic_classification_policies_main_screen_w_examples.png[流量策略示例]

+
现在， S3 和 Swift 客户端流量将根据流量分类策略进行处理。您可以查看流量图表并验证策略是否正在强制实施预期的流量限制。请参见 xref:viewing-network-traffic-metrics.adoc[查看网络流量指标]。


